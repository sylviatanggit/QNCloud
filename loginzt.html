<!DOCTYPE html>
<html>

    <head>
        <meta charset="UTF-8">
        <title>青囊云平台登录</title>
    </head>
    <link rel="stylesheet" type="text/css" href="css/qk/danju_pulic.css" />
    <link rel="stylesheet" type="text/css" href="css/reset.css" />
    <link rel="stylesheet" type="text/css" href="plugins/layui/css/layui.css" />
    
    <style type="text/css">
        html,
        body {
            width: 100%;
            /*min-width: 1024px;*/
            height: 100%;
            /*min-height: 850px;*/
            box-sizing: border-box;
            overflow-y: visible
        }
        
        .container {
            width: 100%;
            height: 100%;
            background-image: url(image/background.png);
            background-size: 100% 100%;
            background-repeat-y: initial;
            background-size: 100% 100%;
            text-align: center;
            overflow-x: hidden;
            /*display: table;*/
        }
        .login_body , .choose_body{
            margin: auto;
            width: 406px;
            height: 478px;
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background-color: white;
            opacity: 0.9;
            border-radius: 10px;
        }
        
        .login_title {
            height: 52px;
            text-align: center;
            margin-top: 58px;
            line-height: 52px;
            margin-left: -180px;
        }
        
        input,
        select,
        option {
            margin: 0;
            padding: 0;
        }
        
        .login_title img {
            display: inline-block;
        }
        
        .login_title .name {
            /*          position: absolute;
*/
            margin-left: 20px;
            width: auto;
            height: 52px;
            line-height: 52px;
        }
        
        .login_title .name1 {
            position: absolute;
            top: 50px;
            font-family: "YouYuan";
            font-size: 30px;
            color: #357BEA;
        }
        
        .login_title .name2 {
            /*margin-top: 8px;*/
            position: absolute;
            top: 80px;
            font-family: "PingFang";
            font-size: 14px;
            color: #7B7B7B;
        }
        
        .account {
            margin-left: 52px;
            margin-top: 36px;
            width: 302px;
        }
        
        .yanzhengma {
            /*margin-left: 50px;*/
            margin-top: 14px;
            width: 302px;
            position: relative;
        }
        
        .login_account,
        .login_pwd,
        .login_zt,
        .login_yanzhengma {
            width: 260px;
            border: 1px solid #7c7c7c;
            border-radius: 4px;
            position: relative;
            box-sizing: border-box;
            height: 38px;
            padding-left: 42px;
            font-family: "PingFang";
            font-size: 14px;
            color: #7c7c7c;
        }
        
        .login_zt {
            padding-left: 40px
        }
        
        .login_yanzhengma {
            margin-left: 0px;
            padding-left: 14px;
            width: 160px;
        }
        
        .account img,
        .pwd img,
        .zt img {
            position: absolute;
            margin: 8px 20px 8px 14px;
            z-index: 10;
        }
        
        .pwd,
        .zt {
            margin-top: 14px;
        }
        
        .login {
            width: 302px;
            height: 38px;
            margin-top: 20px;
            margin-left: 52px;
        }
        
        .login_btn ,.choose_btn,.sure_btn{
            font-family: "PingFang";
            font-size: 18px;
            color: #fefefe;
            background-color: #357BEA;
            border: none;
            width: 131px;
            height: 38px !important;
            border: 1px solid #357BEA;
            cursor: pointer;
            border-radius: 4px;
        }
        
        .login_copyright {
            margin-top: 20px;
            /*margin-bottom: 26px;*/
            font-family: "PingFang";
            font-size: 12px;
            color: #357BEA;
        }
        
        .info p {
            margin-top: 12px;
            color: #232323;
            font-family: "PingFang SC";
            font-size: 12px;
            text-align: left;
            margin-left: 72px;
        }
        
        #create {
            display: inline-block;
            width: 100px;
            height: 30px !important;
            position: absolute;
            left: 250px;
            top: 0;
        }
        
        .change a {
            width: 80px;
            position: absolute;
            text-decoration: none;
            color: #357BEA;
            font-size: 12px;
            cursor: pointer;
            top: 23px;
            left: 245px;
        }
        
        .chooseZT {
            border: 1px solid #2D89DD;
            width: 400px;
            height: 300px;
            font-family: "PingFang SC";
            font-size: 12px;
            /*box-shadow: 0px 20px #90CAFF;*/
            /*position: relative;*/
            position: absolute;
            top: calc(50% - 150px);
            left: calc(50% - 200px);
            z-index: 100;
            background: #FFFFFF;
        }
        
        .chooseZT_title {
            margin-top: 14px;
            margin-left: 14px;
            color: #777777;
        }
        
        .chooseZT_title img {
            width: 20px;
        }
        
        .chooseZT_title span {
            margin-left: 10px;
        }
        
        .chooseZT_body {
            margin: 0 44px;
            margin-top: 30px;
        }
        
        .chooseZT_body .chooseZT_body_title .find {
            float: right;
        }
        
        a {
            text-decoration: none;
        }
        
        .chooseZT_body table {
            width: 452px;
            /*border: none;*/
            border: 1px solid #CCCCCC;
        }
        
        .chooseZT_body table tr {
            line-height: 22px;
            border-bottom: 1px solid #CCCCCC;
        }
        
        .chooseZT_footer {
            margin: 0 44px;
            margin-top: 45px;
        }
        
        .chooseZT_footer ul li {
            /*display: inline-block;*/
            width: 300px;
            margin-top: 20px;
        }
        
        .chooseZT_footer ul li label {
            display: inline-block;
            width: 60px;
        }
        
        .chooseZT_footer ul li input,
        .chooseZT_footer ul li select {
            display: inline-block;
            margin-left: 12px;
            width: 200px;
            border: none;
            line-height: 28px;
            height: 28px;
            border: 1px solid #CCCCCC;
            border-radius: 2px;
            box-sizing: border-box;
        }
        
        .chooseZT_footer_btn {
            margin-top: 20px;
            float: right;
        }
        
        .chooseZT_footer_btn button {
            cursor: pointer;
            border: none;
            background-color: #2D89DD;
            color: white;
            line-height: 28px;
            width: 70px;
            margin-left: 6px;
            border-radius: 2px;
        }
        
        .chooseZT .close {
            float: right;
            margin-right: 30px;
            font-size: 16px;
            cursor: pointer;
        }
        .hidden{
            display: none;
        }
        /*6.14之后改的首页样式*/
        .chazhao{
            background: #357BEA;
            color: white;
            padding: 7px;
            font-size: 7px;
        }
        .fl{
            float: left;
        }
        .fr{
            float: right;
        }
        .choose_title{
            width: 92%;
            margin-left: 0px;
            height: 30px;
            margin: 0 auto;
            margin-top: 19px;
        }
        .choose_one span{
            height: 10px;
            line-height: 0.9;
            width: 72px;
        }
        .clear{
            clear: both;
        }
        .name_duankou{
            width: 92%;
            margin: 0 auto;
            margin-top: 10px;
        }
        .name_duankou input,.name_duankou .choose_zt{
            height: 20px !important;
            min-height: 20px !important;
            width: 95px;
            margin-left: 8px;
        }
        .duankou_height{
            height: 40px;
            width: 50%;
        }
        .layui-table, .layui-table-view{
            margin-top: 0px !important;
        }
        .login_body input,.login_body select{
            height: 38px !important;
        }
        .layui-form ,.layui-border-box, .layui-table-view{
            height: 135px !important;
        }
    </style>
    
    <body>
        <div class="container quickFlip">
            <div style="width: 406px !important;">
            <div class="login_body">
                <div class="login_title">
                    <img src="image/logo.png" alt="logo" width="52" height="52" />
                    <span class="name">
                        <span class="name1">青囊云平台</span>
                    <span class="name2">权威的医疗器械管理系统</span>
                    </span>
                </div>
                <div class="account">
                    <img src="image/username.png" alt="" />
                    <input type="text" class="login_account" value="" placeholder="请输入用户名" />
                </div>
                <div class="pwd">
                    <img src="image/password.png" />
                    <input type="password" class="login_pwd" placeholder="请输入密码" />
                </div>
                <div class="zt">
                    <img src="image/zhangtao.png" />
                    <select class="login_zt">
                        <option selected="selected" disabled="disabled" style="display: none;">请选择帐套</option>
                    </select>
                </div>
                <div class="yanzhengma">
                    <input type="text" class="login_yanzhengma" placeholder="请输入验证码" />
                    <canvas id="create"></canvas>
                    <span class="change"><a>看不清换一张</a></span>
                </div>
                <div class="login">
                    <input type="button" class="choose_btn quickFlipCta" value="选择账套" />
                    <input type="button" class="login_btn" value="登录" />
                </div>
                <div class="login_copyright">
                    <p>©南京吉帝思信息科技有限公司·版权所有</p>
                </div>
            </div>
            <!--选择账套-->
            <div class="choose_body hidden">
                <div class="login_title" style="margin-top: 30px;">
                    <img src="image/logo.png" alt="logo" width="52" height="52" />
                    <span class="name">
                        <span class="name1" style="top: 16px;">青囊云平台</span>
                    <span class="name2" style="top: 46px;">权威的医疗器械管理系统</span>
                    </span>
                </div>
                <div class="login_title choose_title">
                    <div class="choose_one">
                        <span class="fl" style="margin-top: 9px;">服务器列表</span>
                        <span class="chazhao fr">查找服务器</span>
                    </div>
                    <div class="clear"></div>
                </div>
                <div style="margin: 0 auto;width: 92%;"><table id="fuwuqiliebiao" lay-filter="demo" ></table></div>
                <div class="name_duankou" style="margin-top: 20px;">
                    <div class="duankou_height fl"><span class="fl">服务器名称</span><input type="text" class="fl"></div>
                    <div class="duankou_height fr"><span class="fl">服务器端口</span><input type="text" class="fl"></div>
                </div><div class="name_duankou">
                    <div class="duankou_height fl"><span class="fl">服务器地址</span><input type="text" class="fl"></div>
                    <div class="duankou_height fr">
                    	<span class="fl" style="width: 70px;text-align: right;">选择账套</span>
                    	<select class="choose_zt" style="width: 99px;height: 24px !important;margin-left: 0px;">
	                        <option selected="selected">请选择帐套</option>
	                    </select>
                    </div>
                </div>
                <div class="choose">
                    <input type="button" class="choose_btn" value="测试连接" style="margin-top: 15px;"/>
                    <input type="button" class="sure_btn quickFlipCta" value="确认" />
                </div>
                <div class="login_copyright">
                    <p>©南京吉帝思信息科技有限公司·版权所有</p>
                </div>
            </div>
            </div>
        </div>
    </body>
    <script src="plugins/layui/layui.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/public.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/jquery.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/jquery.quickflip.source.js" type="text/javascript"></script>
    <script src="js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/jquery.quickflip.source.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(function() {
            $('.quickFlip').quickFlip();
        });
    </script>
    <script type="text/javascript">
        layui.use(['element', "jquery", 'layer','table'], function() {
            var element = layui.element;
            var $ = layui.$;
            var layer = layui.layer;
            var table = layui.table;

            
            $(function() {
                code = createCode();
            })
            $('.change').click(function() {
                code =  createCode()
            })

        

            function zhangtao() {

                $.ajax({
                    type: "post",
                    url: localStorage.serIp + "/WebGetBooksList?jsoncallback=?",
                    async: true,
                    dataType: 'jsonp',
                    success: function(res) {
                        var data = JSON.parse(res);
                        for(var i = 0; i < data.length; i++) {
                            var opt = "";
                        
                            opt = "<option>" + data[i].books + "</option>"
    
                            $(".login_zt").append(opt);
                            $(".choose_zt").append(opt);
                            
                            
                        }
                        if(localStorage.database){
                            $(".login_zt option:contains('"+localStorage.database+"')").attr("selected","selected");
							$(".choose_zt option:contains('"+localStorage.database+"')").attr("selected","selected");
                        }
                    }
                });

            }
            
            zhangtao();
            //服务器地址
            localStorage.serIp = 'http://192.168.0.120:11529/ByuWCFService';
            
            //登录
            function login_ajax() {
                var userName = $(".login_account").val();
                var pwd = $(".login_pwd").val();
                var database = $(".login_zt").val();
                var inputCode = $('.login_yanzhengma').val().toUpperCase();
                //把随机生成的验证码转化为大写
                var codeUp = code.toUpperCase()
                if(!userName) {
                    layer.open({
                        title: "提示",
                        content: '请输入账号'
                    });
                } else if(!pwd) {
                    layer.open({
                        title: "提示",
                        content: '请输入密码'
                    });
                } else if(inputCode.length <= 0) {
                    $('.login_yanzhengma').attr('placeholder', '验证码');
                    layer.open({
                        title: "提示",
                        content: '请输入验证码'
                    });
                    code = createCode()
                    return false
                } else if(inputCode != codeUp) {
                    $('.login_yanzhengma').val('')
                    //修改属性值。
                    $('.login_yanzhengma').val('').attr('placeholder', '请重新输入');
                    layer.open({
                        title: "提示",
                        content: '验证码填写错误'
                    });
                    code = createCode();
                    return false;
                } else {
                    $.ajax({
                        type: "post",
                        url: localStorage.serIp + "/WebCheckUserLogin?jsoncallback=?",
                        async: true,
                        dataType: "json",
                        data: {
                            "userId": userName,
                            "userPw": pwd,
                            'database': database
                        },
                        success: function(res) {
                            var data = JSON.parse(res)

                            if(data.infoType == 1) {
                                layer.open({
                                    title: "提示",
                                    content: '用户名不存在'
                                });
                            } else if(data.infoType == 2) {
                                layer.open({
                                    title: "提示",
                                    content: '密码不正确'
                                });
                            } else if(data.infoType == 3) {
                                layer.open({
                                    title: "提示",
                                    content: '无权登录'
                                });
                            } else if(data.infoType == 4) {
                                layer.open({
                                    title: "提示",
                                    content: '登录异常'
                                });
                            } else if(data.infoType == 0) {
                                var datas = JSON.parse(data.info);
                                //登录名称
                                localStorage.userId = userName;
                                localStorage.userPw = pwd;
                                localStorage.database = database;
                                //公司名字
                                localStorage.companyname = datas.companyname;
                                //本公司id
                                localStorage.groupcompanyid = datas.groupcompanyid;
                                //管理员名称
                                localStorage.employeeName = datas.employeeName;
                                //权限
                                localStorage.employeeOrder = datas.employeeOrder;
                                //子公司数量
                                localStorage.allowCompanyCount = datas.allowCompanyCount;
                                //是否可以看到成本价
                                localStorage.viewrealcost = 1;
								
								//
								//1不显示，0显示1已经过滤，0没有过滤
								localStorage.isshow = 0;
								//检查经营范围：0不检查，1检查
								localStorage.forcecheck = 1;
								//是否每月强制盘库 0不强制 1 强制
								localStorage.forcecountstock = 0;
								//预警提示0，不预警，1，预警*顺序为：注册证，产品上下限，产品有效期*
								localStorage.warning = 0;

								
								
//                              location.href = "http://192.168.0.117/QNCloud/"
                                location.href = "index.html"
                            }
                        }
                    });
                }
            }
            $(".login_btn").click(function() {
                login_ajax();
            });

            $("body").keydown(function(event) {
                if(event.keyCode == "13") { //keyCode=13是回车键
                    login_ajax();
                }
            });
            //点击选择账套
            $(".choose_btn").click(function(){
                $(".choose_body").removeClass("hidden");
                $(".login_body").addClass("hidden");
            })
            //点击确认
            $(".sure_btn").click(function(){
                $(".choose_body").addClass("hidden");
                $(".login_body").removeClass("hidden");
            })
            //调用table
            
            var data=[{
                'producename':1,
                'manufacturer':2,
                'danwei':3
                
            },{
                'producename':1,
                'manufacturer':2,
                'danwei':3
                
            },{
                'producename':1,
                'manufacturer':2,
                'danwei':3
                
            }]
            operationDetail(data)
            function operationDetail(data) {
                //展示已知数据
                table.render({
                    elem: '#fuwuqiliebiao',
                    data: data,
                    id: 'fuwuqiliebiao',
                    height: "full-700",
                    cols: [
                        [ //标题栏

                            {
                                checkbox: true,
//                              LAY_CHECKED: true,
                                align: "center",
                                width: 40,
                            },
                            {
                                field: 'producename',
                                title: '服务器名称',
                                align: "center",
                                width: 120,
                            }, {
                                field: 'manufacturer',
                                title: '服务器地址',
                                align: "center",
                                width: 120,
                            },
                            {
                                field: 'danwei',
                                title: '端口',
                                align: "center",
                                width: 80
                            }
                        ]
                    ],
                    skin: 'row' //表格风格
                        ,
                    even: true,
                    page: false //是否显示分页
                        ,
                    limits: [10, 20, 30, 40, 50],
                    limit: 50 //每页默认显示的数量
                });
            }

        });
        

    </script>

</html>