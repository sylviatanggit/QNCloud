<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<title>添加货区</title>
		<link rel="stylesheet" href="../../../plugins/layui/css/layui.css">
				<link href="../../../css/font-awesome.min.css" rel="stylesheet">
		<link rel="stylesheet" type="text/css" href="../../../css/comboselect.css" />
		<link rel="stylesheet" type="text/css" href="../../../css/demo.css" />
		<link rel="stylesheet" href="../../../plugins/layui/css/layui.css">
		<link href="../../../css/font-awesome.min.css" rel="stylesheet">
	</head>
	<style type="text/css">
		#addgoods {
			/*width: calc(100vw+17px);*/
			font-size: 9pt;
		}
		
		#addgoods legend {
			font-family: "PingFang" !important;
			font-size: 14px !important;
			color: #2D89DD !important;
			font-weight: 800 !important;
		}
		
		#addgoods label {
			width: 120px !important;
			font-size: 9pt !important;
			color: #232323 !important;
		}
		
		#addgoods input {
			font-size: 9pt !important;
			width: 400px !important;
			height: 28px !important;
		}
		
		#addgoods select {
			font-size: 9pt !important;
			width: 400px !important;
			height: 28px !important;
			/*border: 1px solid #DDDDDD !important;*/
		}
		
		#addgoods textarea {
			font-size: 9pt !important;
			width: 400px !important;
			height: 80px;
			/*border: 1px solid #ddd !important;*/
		}
		
		#addgoods .layui-form-title {
			width: 100%;
			right: 15px;
			padding-top: 5px;
			margin-bottom: -20px;
			position: fixed;
			z-index: 100;
			background-color: #FFFFFF !important;
			line-height: 32px;
			top: 1px;
		}
		
		#addgoods button {
			margin-left: 8px;
			text-align: center;
			width: 76px;
			height: 28px;
			line-height: 28px;
			float: right;
			font-family: "PingFang" !important;
			font-size: 14px !important;
			color: #FFFFFF !important;
			background-color: #2D89DD !important;
		}
		
		.current {
			background-color: #357BEA;
		}
		
		#addgoods {
			margin-bottom: 120px;
		}
		
				
		.cleardata{
			cursor: pointer;
			margin-top: 5px;
		}
		
		.layui-form-item .layui-input-inline{
			width: auto !important;
		}
	</style>

	<body>
		<div id="addgoods">
			<div class="layui-form-item layui-form-title">
				<button class="layui-btn addgoods_submit">提交</button>
			</div>
			<fieldset class="layui-elem-field layui-field-title" style="margin-top: 40px;">
				<legend>仓库信息</legend>
			</fieldset>
			<div class="layui-form-item">
				<label class="layui-form-label"><b style="color: red !important;margin-right: 4px;">*</b>仓库名称：</label>
				<div class="layui-input-block">
					<input  class="layui-input addgoods_ckname" type="text" value="" disabled="disabled">

				</div>
			</div>
			
			<div class="layui-form-item">
			<label class="layui-form-label" style="margin-left: 0px;"><b style="color: red !important;margin-right: 4px;">*</b>库存来源：</label>
			<div class="layui-input-inline">
				<select name="" class="layui-input source">
					<option value="0">总部采购</option>
					<option value="1">子公司收购</option>
					<option value="2">子仓调拨</option>
				</select>
			</div>
		</div>
		
		<div class="layui-form-item">
			<label class="layui-form-label" style="margin-left: 0px;"><b style="color: red !important;margin-right: 4px;">*</b>货区性质：</label>
			<div class="layui-input-inline">
				<select name="" class="layui-input areatype">
					<option value="0">存货</option>
					<option value="1">备货</option>
				</select>
			</div>
		</div>
				
			<div class="layui-form-item">
				<label class="layui-form-label"><b style="color: red !important;margin-right: 4px;">*</b>货区编号：</label>
				<div class="layui-input-block">
					<input autocomplete="off" class="layui-input addgoods_hqbh" type="text" value="">

				</div>
			</div>
			<div class="layui-form-item">
				<label class="layui-form-label"><b style="color: red !important;margin-right: 4px;">*</b>货区名称：</label>
				<div class="layui-input-block">
					<input autocomplete="off" class="layui-input addgoods_hqname" type="text" value="">

				</div>
			</div>
						
			<div class="layui-form-item">
				<label class="layui-form-label" style="margin-left: 0;"><b style="color: red !important;margin-right: 4px;">*</b>负责人：</label>
				<div class="layui-input-inline">
					<input  autocomplete="off" class="layui-input name" id="staffName" type="text">
				</div>
				
				<!--<div class="layui-input-inline cleardata">
					X
				</div>-->
			
			</div>
			<div class="layui-form-item">
				<label class="layui-form-label">货区地址：</label>
				<div class="layui-input-block">
					<input autocomplete="off" class="layui-input address" type="text" value="">

				</div>
			</div>
			<div class="layui-form-item">
				<label class="layui-form-label">行政区域：</label>
				<div class="layui-input-block">
					<input autocomplete="off" class="layui-input administrativedivision" type="text" value="">

				</div>
			</div>
			
			<div class="layui-form-item">
				<label class="layui-form-label">备　　注：</label>
				<div class="layui-input-block">
					<textarea autocomplete="off" class="layui-input addgoods_reginfo" data-id="" type="text" value="" style="height: 100px;"></textarea>

				</div>
			</div>
		</div>
		
		<!--<input  autocomplete="off" class="layui-input name" id="staffName" type="hidden">-->
	</body>
	<script src="../../../plugins/layui/layui.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
		
		

		layui.use(['jquery', 'layer'], function() {
			var $ = layui.$, //重点处
			layer = layui.layer;
			
		$(".addgoods_ckname").val(sessionStorage.warehousename);
		
		
		function staffList() {
			$.ajax({
				type: "get",
				url: localStorage.serIp+"/WebGetEmployeeDropDownList?jsoncallback=?",
				dataType: "jsonp",
				async: true,
				data: {
					'userId': localStorage.userId,
					'userPw': localStorage.userPw,
					'database': localStorage.database,
					"groupCompanyId":sessionStorage.groupcompanyid,
					"txtCondition": ''
			
				},
				success: function(res) {
					var data = JSON.parse(res);
					$('#staffName').bComboSelect({
						showField: 'employeename',
						keyField: 'employeesid',
						data: data
					});
				}
			});
		}
		staffList()
			
		$(".addgoods_hqbh").change(function(){
			var addgoods_hqbh=$(".addgoods_hqbh").val();
			if(addgoods_hqbh == ""){
				return;
			}

			$.ajax({
				type: "get",
				url: localStorage.serIp+"/WebCheckGoodsareaIDIsRepeat?jsoncallback=?",
				async: true,
				dataType: 'jsonp',
				data: {
					"userId": localStorage.userId,
					"userPw": localStorage.userPw,
					'database': localStorage.database,
					'groupCompanyId': localStorage.groupcompanyid,
					'areaid':addgoods_hqbh,
					'warehouseid' : sessionStorage.warehousid
				},
				success: function(res) {
					var data = JSON.parse(res);
					if(data.ResultValue == "1") {
						layer.tips('货区编号已存在!',".addgoods_hqbh", {tips:3});

						$(".addgoods_hqbh").val("");  
					} 
				}
				
				
			});
		})
			
			
			
		$(".addgoods_hqname").change(function(){
			var addgoods_hqname=$(".addgoods_hqname").val();

			if(addgoods_hqname == ""){
				return;
			}

			$.ajax({
				type: "get",
				url: localStorage.serIp+"/WebCheckGoodsareaIsRepeat?jsoncallback=?",
				async: true,
				dataType: 'jsonp',
				data: {
					"userId": localStorage.userId,
					"userPw": localStorage.userPw,
					'database': localStorage.database,
					'groupCompanyId': localStorage.groupcompanyid,
					'areaname':addgoods_hqname,
					'warehouseid' : sessionStorage.warehousid
				},
				success: function(res) {
					var data = JSON.parse(res);
					if(data.ResultValue == 1) {
						layer.tips('货区名已存在!',".addgoods_hqname", {tips:3});

						$(".addgoods_hqname").val("");  
					} 
				}
				
				
			});
		})
				
			
			$(".addgoods_submit").click(function() {
				var addgoods_hqbh = $('.addgoods_hqbh').val();
				var addgoods_hqname = $('.addgoods_hqname').val();
				var addgoods_reginfo = $('.addgoods_reginfo').val();
				
				var source = $('.source').val();
				var areatype = $('.areatype').val();
				var address = $('.address').val();
				var chargemanid = $('#staffName').val();
				var administrativedivision = $('.administrativedivision').val();
				
				if(addgoods_hqbh == '') {
					parent.layer.open({
						title: "提示",
						content: '请填写货区编号！',	zIndex: parent.layer.zIndex //重点1
						
					});
					return false;
				}
				
				if(addgoods_hqname == '') {
					parent.layer.open({
						title: "提示",
						content: '请填写货区名称！',	zIndex: parent.layer.zIndex //重点1
						
					});
					return false;
				}
				
				if(chargemanid == '') {
					parent.layer.open({
						title: "提示",
						content: '请选择负责人！',	zIndex: parent.layer.zIndex //重点1
						
					});
					return false;
				}
								
				
				var slave = {
					'warehouseid': sessionStorage.warehousid,
					'areaid': addgoods_hqbh,
					'areaname':addgoods_hqname,
					'nomo':addgoods_reginfo,
					'source' : source,
					'areatype':areatype,
					'address':address,
					'chargemanid':$('#staffName').val(),
					'administrativedivision':administrativedivision,
					'nature':sessionStorage.wareHousenature,
					'warehousename':sessionStorage.warehousename
				};
			
			
					var  jiazaiIndex;
					parent.layer.open({
					  type: 3, zIndex: parent.layer.zIndex ,	//重点1
					  success: function(layero, index){
					  	jiazaiIndex = index;
			  			}
					});
				
				
				$.ajax({
					type: "get",
					url: localStorage.serIp+"/WebAddGoodsareaTable?jsoncallback=?",
					async: true,
					dataType: 'jsonp',
					data: {
						"userId": localStorage.userId,
						"userPw": localStorage.userPw,
						'database': localStorage.database,
						'groupCompanyId': localStorage.groupcompanyid,
						'slave': JSON.stringify(slave)
					},
					success: function(res) {
						var data = JSON.parse(res);
							parent.layer.close(jiazaiIndex); 

						if(data.ResultValue == 1) {
							parent.layer.open({
								title: "提示",
								content: '添加成功！',	zIndex: parent.layer.zIndex//重点1
								,
								success: function(layero, index){
										var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
										parent.layer.close(index); //再执行关闭  
								 }	
							});
							
								
						} else {
							parent.layer.open({
								title: "提示",
								content: '添加失败！',	zIndex: parent.layer.zIndex //重点1
						
							});
						}
					}
				});
			})
		});
	</script>
<script src="../../../js/jquery.js" type="text/javascript"></script>
	<script type="text/javascript" src="../../../js/comboselect.js"></script>
	<script type="text/javascript" src="../../../js/b.comboselect.js"></script>
</html>