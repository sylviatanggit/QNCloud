<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<title>待办列表</title>

	<link rel="stylesheet" type="text/css" href="../../../css/demo.css" />
	<link rel="stylesheet" href="../../../plugins/layui/css/layui.css">
	<link href="../../../css/font-awesome.min.css" rel="stylesheet">


	<!-- DevExtreme themes -->
	<!-- <link rel="stylesheet" href="../../../devexpresslibrary/css/dx.common.css">
	<link rel="stylesheet" href="../../../devexpresslibrary/css/dx.light.css">
	<link rel="stylesheet" type="text/css" href="../../../css/same.css" />
	<link rel="stylesheet" type="text/css" href="../../../css/comboselect.css" /> -->

</head>
<style type="text/css">
	table thead td {
		padding: 0;
		border-left: 1px solid #CAD3DA;
		background: #DFEBFB;
	}

	table tbody tr:nth-child(even) {
		background: #E7EFF9;
	}

	.dx-datagrid-text-content {
		color: grey;
	}

	.clearfix:after {
		content: '.';
		height: 0;
		display: block;
		clear: both;
	}

	.layui-laypage-limits {
		font-size: 12px;
		display: none;
		float: left;
		margin-top: 7px;
	}

	#lay-ignore {
		height: 25px;
		width: 60px;

	}

	#lay-ignore {
		height: 25px;
		width: 60px;

	}

	tbody tr:not(:last-child):hover {
		background-color: rgba(137, 207, 240, .6)!important;
	}

	.dx-datagrid-rowsview .dx-selection.dx-row>td {
		background-color: yellow!important;
	}

	colgroup>col:first-child {
		width: 45px!important;
	}

	.dx-col-fixed:nth-child(1) {
		width: 45px !important;
	}

	.M-box2 {
		display: inline-block;
		padding: 0 15px;
		height: 28px;
		color: #333;
		font-size: 12px;
		margin-top: 6px;
	}

	.M-box2 a {
		margin-left: 15px;
		padding: 0 15px;
		text-decoration: none;
		background-color: #ffffff;
		color: #000000;
	}

	.M-box2 .active {
		margin-left: 5px;
		padding: 0 15px;
		color: #ffffff;
		width: 100%;
		height: 100%;
		background-color: #2D89DD;
		border: 1px solid #e2e2e2;
	}

	.jump-ipt {
		float: none;
		margin-left: 5px;
		margin-left: 11px;
		width: 60px;
		border: 1px solid #e6e6e6;
		height: 20px!important;
	}

	.dx-data-row,
	.dx-column-lines:not(:first-child)>td:nth-child(2) {
		cursor: pointer;
	}

	.dx-widget {
		font-size: 9pt!important;
		line-height: 17px;
	}

	.option>.dx-selectbox {
		display: inline-block;
		vertical-align: middle;
	}

	.layui-input {
		color: #000000;
	}

	.dx-column-lines>td:nth-child(2) {
		color: #2D89DD;
	}

	.dx-data-row,
	.dx-column-lines>td:nth-child(2) {
		cursor: pointer;
	}

	.totalInfo {
		width: 100px;
		height: 20px;
		float: left;
		margin-top: 12px;
	}

	.fl {
		float: left;
	}

	.fr {
		float: right;
	}

	.inputs {
		margin-bottom: 8px;
		border-radius: 0;
	}

	.purchase {
		font-family: "PingFang SC" !important;
		font-size: 9pt !important;
		color: #232323 !important;
		padding-top: 8px;
	}

	.btns {
		float: right;
		margin-top: 18px;
	}

	label {
		padding: 0 !important;
		margin-left: 0px;
	}

	.btns button,
	.find,
	.import {
		padding: 0;
		cursor: pointer;
		border: none;
		width: 76px;
		height: 28px;
		text-align: center;
		line-height: 28px;
		border-radius: 2px;
		background-color: #2D89DD;
		color: #FFFFFF;
		margin-left: 8px;
		font-size: 9pt;
	}

	.btns button {
		width: 90px;
	}


	.layui-laypage {
		margin: 0;
		position: absolute;
		bottom: 0px;
		left: 25px;
	}



	.cs_container,
	.cs_container_open .cs_input,
	.cs_result_area {
		width: 250px !important;
	}

	div.cs_result_area div.pagination li {
		margin: 0 4px !important;
	}


	.cleardata {
		cursor: pointer;
	}

	.cleardata1 {
		cursor: pointer;
	}

	.layui-inline {
		margin-top: 10px;
	}

	#gridContainer {
		margin-top: 17px;
	}
</style>


<body>
	<div class="purchase">
		<div class="layui-tab">
			<div class="purchase_header">
				<div class="inputs" style="margin-left: 14px;margin-bottom: 8px;">
					<div style="width: 100%;height: auto;">
						<div class="layui-inline" id="fengongsiId" style="margin-right: 15px;">
							<label class="layui-form-label" style="margin-left: 0px;">所属公司</label>
							<div class="layui-input-inline">
								<select name="" class="layui-input companytypeid" style="width: 200px;">
									<option value="-1">全部</option>

								</select>
							</div>
						</div>


						<div class="layui-inline" style="margin-right: 15px;width: 308px;">
							<label class="layui-form-label" style="margin-right: 10px;">往来单位</label>
							<div id="append_group">
								<input autocomplete="off" class="layui-input unit" type="text" id="unit" style="width: 250px;height: 28px;line-height: 28px;">
							</div>

						</div>

						<div class="layui-inline" style="margin-right: 15px;width: 308px;">
							<label class="layui-form-label" style="margin-right: 10px;">业务员</label>
							<div id="append_sale">
								<input autocomplete="off" class="layui-input salesman" id="salesman" type="text" style="width: 250px;height: 28px;line-height: 28px;">
							</div>
						</div>
					</div>


					<div style="width: 100%;height: auto;position: relative;margin-top: 8px;">



						<div class="layui-inline" style="margin-right: 10px;">
							<div class="layui-input-inline">
								<input autocomplete="off" class="layui-input seachContent" type="text" placeholder="请输入关键字" style="margin-left: 0px;width: 240px;">
							</div>
						</div>
						<div class="layui-inline">
							<button class="layui-btn find" style="margin-left: 0px;">查询</button>
						</div>
						<div class="btns" style="margin-top: 18px;margin-right: 20px;">

							<button class="layui-btn moreAction" style="margin-right: 0px;">更多操作</button>
							<ul class="action">
								<li>
									<a class="addDianJiEvent" data-type="HBSK" lay-event='HBSK'>合并收款</a>
								</li>
							</ul>


						</div>
					</div>
				</div>

				<table id="houselist" lay-filter="demo" style="margin-top: 8px;">
					<div class="demo-container">
						<div id="gridContainer"></div>
					</div>
				</table>
				<div class="footer .clearfix">
					<div class="totalInfo fl"></div>
					<div class="M-box2 fl"></div>
					<span class="layui-laypage-limits">
						<select id="lay-ignore">
							<option value="50" selected>50</option>
							<option value="100">100</option>
							<option value="200">200</option>
						</select>
						<span>条/页</span>
					</span>
				</div>
			</div>
</body>

	
<script type="text/javascript">
	var limit = 50;
	var currentPage = 1;
	var totalInfo = '';
	var count;
	layui.use(['table', 'jquery', 'element', 'laydate', 'laypage'], function () {
		var table = layui.table;
		var $ = layui.jquery;
		$('.moreAction').hover(function () {
			$(".action").show();
		}, function () {
			$(".action").hide();
		});
		$('.action').hover(function () {
			$(".action").show();
		}, function () {
			$(".action").hide();
		});

		var laypage = layui.laypage;
		var laydate = layui.laydate;
		var myDate = new Date();
		var currentMothFirstDay = getCurrentMothFirstDay();
		var currentDate = myDate.getFullYear() + '-' + (myDate.getMonth() + 1) + '-' + myDate.getDate();
		getunit(6,0);
		var groupcompanyid = localStorage.groupcompanyid;



		var limit = 50;
		var curpage = 1;
		var count;


		if (localStorage.groupcompanyid != "0") {
			$("#fengongsiId").css("display", "none");
			waitData(currentPage, limit, totalInfo);
		} else {
			dataFun1();
		}

		//获取公司信息
		function dataFun1() {
			$.ajax({
				type: "get",
				url: localStorage.serIp + "/WebGetAllGroupCompany?jsoncallback=?",
				dataType: "jsonp",
				async: true,
				data: {
					'userId': localStorage.userId,
					'userPw': localStorage.userPw,
					'database': localStorage.database,
					"groupCompanyId": localStorage.groupcompanyid
				},
				success: function (res) {
					var desData = JSON.parse(res);
					var optionsStr = "";
					for (var i = 0; i < desData.length; i++) {
						var id = desData[i].myg_companyid;
						var name = desData[i].companyname;


						if (id == localStorage.groupcompanyid) {
							optionsStr += "<option value='" + id + "' selected='selected'>" + name + "</option>";

						} else {
							optionsStr += "<option value='" + id + "'>" + name + "</option>";

						}



					}
					$(".companytypeid").append(optionsStr);

					waitData(currentPage, limit, totalInfo);
				}
			});

		}


		$(".companytypeid").change(function () {

			waitData(currentPage, limit, totalInfo);
			//业务员跟这变
			groupcompanyid = $(".companytypeid").val();
			groupcompanyid = groupcompanyid == -1 ? '' : groupcompanyid;
			var bandstr = '<input autocomplete="off" class="layui-input salesman" id="salesman" type="text" style="width: 250px;height: 28px;line-height: 28px;">';
			$("#append_sale").empty().append(bandstr);
			staffList();

			//往来单位跟这变
			var append_group = '<input autocomplete="off" onkeyup="value=value.replace(/(^\s*)|(\s*$)/g,"")" class="layui-input unit" type="text" id="unit" style="width: 250px;height: 28px;line-height: 28px;">';
			$("#append_group").empty().append(append_group);
			getunitByConfident(6, groupcompanyid,0);

		})

		function staffList() {
			$.ajax({
				type: "post",
				url: localStorage.serIp + "/WebGetEmployeeDropDownList?jsoncallback=?",
				async: true,
				dataType: 'jsonp',
				data: {
					"userId": localStorage.userId,
					"userPw": localStorage.userPw,
					'database': localStorage.database,
					'groupCompanyId': groupcompanyid
				},
				success: function (res) {
					var data = JSON.parse(res);
					$('#salesman').bComboSelect({
						showField: 'employeename',
						keyField: 'employeesid',
						data: data
					});
				}
			});
		}
		staffList()



		function waitData(currentPage, limit, totalInfo) {

			var unit = $('#unit').val();
			var agentId = $("#salesman").val();
			var orderNum = $(".seachContent").val();


			var companytypeid = "";
			if (localStorage.groupcompanyid == "0") {
				companytypeid = $('.companytypeid option:selected').val();
			} else {
				companytypeid = localStorage.groupcompanyid;
			}
			var jiazaiIndex;
			parent.layer.open({
				type: 3,
				zIndex: parent.layer.zIndex, //重点1
				success: function (layero, index) {
					jiazaiIndex = index;
				}
			});

			$.ajax({
				type: "get",
				url: localStorage.serIp + "/WebGetOutSettlementInfo?jsoncallback=?",
				dataType: "jsonp",
				async: true,
				data: {
					'userId': localStorage.userId,
					'userPw': localStorage.userPw,
					'num': limit,
					'page': currentPage,
					'orderNum': orderNum,
					'companyId': unit,
					'agentId': agentId,
					'database': localStorage.database,
					'groupCompanyId': companytypeid,
					'checkState': 1,
					'lastType': 10
				},
				success: function (res) {
					$('.totalInfo').children().remove();
					parent.layer.close(jiazaiIndex);

					var initData = JSON.parse(res);
					var data = JSON.parse(initData.data);

					count = initData.count;


					var totalInfoTag = '<span>' + '共' + count + '条' + '</span>';
					$('.totalInfo').append(totalInfoTag);
					wait(data, limit);
					pagination(currentPage, limit, count);
					$('.layui-laypage-limits').css('display', 'block');



				}
				,
				error: function (res) {
					parent.layer.close(jiazaiIndex);

					parent.layer.open({
						title: "提示",
						content: '服务器异常!',
						zIndex: parent.layer.zIndex //重点1

					});


				}
			});

		}


		function wait(data, limit) {
			//展示已知数据
			$(function () {
				var dataGrid = $("#gridContainer").dxDataGrid({
					dataSource: data,
					keyExpr: "ordernum",
					allowColumnReordering: true,
					showBorders: true,
					paging: {
						pageSize: 200,
					},
					sorting: {
						mode: "none"//none
					},
					selection: {
						mode: "multiple"
					},
					filterRow: {
						visible: false,
						applyFilter: "auto"
					},
					headerFilter: {
						visible: false
					},
					allowColumnResizing: true,
					columnFixing: {
						enabled: false
					},
					columns: [{
						dataField: "ordernum",
						width: 160,
						caption: "出库核价单号",
						fixed: true,
					}
						,
					{
						dataField: "statesname",
						width: 90,
						caption: "操作状态",
					},
					{
						dataField: "lasttypename",
						width: 90,
						caption: "单据类型"
					},
					{
						dataField: "companyname",
						width: 180,
						caption: "往来单位"
					},
					{
						dataField: "owncompanyname",
						width: 180,
						caption: "所属公司",
					}, {
						dataField: "masterdoctorname",
						width: 80,
						caption: "主刀医生",
					}, {
						dataField: "patienname",
						width: 80,
						caption: "患者姓名",
					}, {
						dataField: 'surgerydate',
						caption: '手术日期',
						format: "yyyy-MM-dd",
						dataType: "date",
						width: 80
					},
					{
						dataField: "totalprice",
						width: 90,
						caption: "总金额",
						format: {
							type: "fixedPoint",
							precision: 2
						},
						customizeText: function (arg) {
							return arg.valueText;
						}
					},
					{
						dataField: "nomoney",
						width: 90,
						caption: "待收",
						format: {
							type: "fixedPoint",
							precision: 2
						},
						customizeText: function (arg) {
							return arg.valueText;
						}
					},
					{
						dataField: "noinvoce",
						width: 90,
						caption: "欠票",
						format: {
							type: "fixedPoint",
							precision: 2
						},
						customizeText: function (arg) {
							return arg.valueText;
						}
					},
					{
						dataField: 'agentname',
						caption: '业务员',
						width: 70
					}, {
						dataField: 'outsettlementdate',
						caption: '核价日期',
						format: "yyyy-MM-dd",
						dataType: "date",
						width: 90
					},
					{
						dataField: 'operatorsidname',
						caption: '制单人',
						width: 70
					}, {
						dataField: 'actiondate',
						caption: '制单日期',
						format: "yyyy-MM-dd",
						dataType: "date",
						width: 90
					}, {
						dataField: 'checkername',
						caption: '审核人',
						width: 70
					}, {
						dataField: 'checkdate',
						caption: '审核日期',
						format: "yyyy-MM-dd",
						dataType: "date",
						width: 90
					},
					{
						dataField: 'lastnum',
						caption: '关联单号',
						fixedPosition: 'right',
						width: 160,
					},
					{
						dataField: 'mynum',
						caption: '自定义单号',
						width: 160,
					},
					{
						dataField: 'nomo',
						caption: '备注',
						width: 180,
					}
					]
					,
					onSelectionChanged: function (obj) {
						var exportCompanyarr = [];
						var taxarr = [];
						var percentagearr = [];
						var slave = [];
						// 发票申请
						var selectedRowsData = obj.selectedRowsData;
						var ordernumList = '';
						var arrForOderNum = [];
						var totalprice = 0;
						var outseltotalprice = 0;
						var outticketarr = [];
						var outticketlist = '';

						var applymodel = $(".applymodel").val();
						for (var i = 0; i < selectedRowsData.length; i++) {
							var danhao = selectedRowsData[i].ordernum;
							danhao = "\'" + danhao + "\'";
							arrForOderNum.push(danhao);
							ordernumList = arrForOderNum.join(",");
							// 往来单位
							var companyideach = selectedRowsData[i].companyid;
							// 税率
							var taxpercentage = selectedRowsData[i].taxpercentage;
							// 票种
							var outtickettypename = selectedRowsData[i].outtickettypename;
							// 总金额
							totalprice += selectedRowsData[i].totalprice;
							//含税成本金额
							outseltotalprice += selectedRowsData[i].outseltotalprice;

							if (exportCompanyarr.indexOf(companyideach) == -1) {
								exportCompanyarr.push(companyideach);
							}
							if (taxarr.indexOf(taxpercentage) == -1) {
								taxarr.push(taxpercentage);
							}
							if (percentagearr.indexOf(outtickettypename) == -1) {
								percentagearr.push(outtickettypename);
							}


							// 发票类型
							var outtickettype = selectedRowsData[i].outtickettype;
							if (outticketarr.indexOf(outtickettype) == -1) {
								outticketarr.push(outtickettype);
							}

							slave.push({
								"jsnum": '' + selectedRowsData[i].ordernum + '',
								"lastnum": '' + selectedRowsData[i].lastnum + '',
								"paymoney": '0',
								"lasttype": '' + selectedRowsData[i].lasttype + ''
							});



						}
						$('.addDianJiEvent').dxButton({
							onClick: function () {
										
								if(!checkPermissionStatus("销售收款单-保存1")){
					
										parent.layer.open({
											title: "提示",
											content: localStorage.jurisdictionTips,
											zIndex: parent.layer.zIndex //重点1
											,
											success: function(layero) {
												parent.layer.setTop(layero); //重点2
											}
										});
										return
										
									}
								
								
								//    选中单据时候判断往来单位是否一致
								if (exportCompanyarr.length > 1) {

									parent.layer.open({
										title: "提示",
										content: '往来单位完全一致才允许合并收款!',
										zIndex: layer.zIndex //重点1
										,
										success: function (layero) {
											parent.layer.setTop(layero); //重点2
										}
									});


									return;

								};


								if (exportCompanyarr.length == 1) {
									var str1 = "	总金额：" + Number(totalprice).toFixed(2);

									var str2 = "	<br>含税成本金额：" + Number(outseltotalprice).toFixed(2);
									var str3 = "	 <br>比例： " + (outseltotalprice / totalprice).toFixed(2) + "%";
									var applymodal = selectedRowsData.length;

									var str;

									str = str1 + str2 + str3;







									var master = {
										'ordernum': '',
										'mynum': '',
										'paydate': '',
										'companyid': '' + exportCompanyarr[0] + '',
										'bankid': "",
										'accountforprint': "",
										'agent': '',
										'operatorSID': localStorage.userId,
										'settlestate': 0,
										'totalmoney': "0",
										'nomo': ''
									};
									var jiazaiIndex;
									parent.layer.open({
										type: 3,
										zIndex: parent.layer.zIndex, //重点1
										success: function (layero, index) {
											jiazaiIndex = index;
										}
									});

									var uploadData = {
										"userId": localStorage.userId,
										"userPw": localStorage.userPw,
										'database': localStorage.database,
										'groupCompanyId': localStorage.groupcompanyid,
										'check': 0,// 0保存或更新，1审核
										"mark": 0 //首次保存传0，继续保存1
									}
									if (master != "") {
										master = JSON.stringify(master);
										uploadData.master = master;
									}

									if (slave != "") {
										slave = JSON.stringify(slave);
										uploadData.slave = slave;

									}
									$.ajax({
										type: "post",
										url: localStorage.serIp + "/WebOperateMboutPayMoneyTable",
										async: true,
										dataType: 'json',
										contentType: 'application/json; charset=utf-8',
										crossDomain: true,
										data: JSON.stringify(uploadData),
										success: function (res) {
											parent.layer.close(jiazaiIndex);

											var data = JSON.parse(res);
											switch (data.SaveState.state) {
												case 0:
													parent.layer.open({
														title: "提示",
														content: data.SaveState.result,
														zIndex: layer.zIndex,//重点1,
														success: function (layero) {
															parent.layer.setTop(layero); //重点2

														}
													});

													return;
													break;
												case 1:

													if (data.CheckState.state == 2) {

														parent.layer.open({
															title: "提示",
															content: '合并收款成功',
															zIndex: layer.zIndex //重点1
															,
															success: function (layero) {
																parent.layer.setTop(layero); //重点2
															}
														});
														waitData(currentPage, limit, totalInfo);
														return;
													}



													break;
											}


										}
										,
										error: function (res) {
											parent.layer.close(jiazaiIndex);

											parent.layer.open({
												title: "提示",
												content: '服务器异常!',
												zIndex: parent.layer.zIndex //重点1

											});


										}
									});






								}


							}
						});

						dataGrid.refresh();
					},
					summary: {
						totalItems: [{
							name: "SelectedRowsSummary",
							showInColumn: "totalprice",
							summaryType: "custom",
						}
							,
						{
							name: "SelectedRowsSummarry",
							showInColumn: "nomoney",
							summaryType: "custom",
						},
						{
							name: "SelectedRowsSummarrry",
							showInColumn: "noinvoce",
							summaryType: "custom",
						}
						],
						calculateCustomSummary: function (options) {
							if (options.name === "SelectedRowsSummary") {
								if (options.summaryProcess === "start") {
									options.totalValue = 0;
								};
								if (options.summaryProcess === "calculate") {
									if (options.component.isRowSelected(options.value.ordernum)) {
										options.totalValue = options.totalValue + options.value.totalprice;
										options.totalValue = Math.round(options.totalValue * 100) / 100;
									}
								}
							}
							if (options.name === "SelectedRowsSummarry") {
								if (options.summaryProcess === "start") {
									options.totalValue = 0;
								};
								if (options.summaryProcess === "calculate") {
									if (options.component.isRowSelected(options.value.ordernum)) {
										options.totalValue = options.totalValue + options.value.nomoney;
										options.totalValue = Math.round(options.totalValue * 100) / 100;
									}
								}
							}
							if (options.name === "SelectedRowsSummarrry") {
								if (options.summaryProcess === "start") {
									options.totalValue = 0;
								};
								if (options.summaryProcess === "calculate") {
									if (options.component.isRowSelected(options.value.ordernum)) {
										options.totalValue = options.totalValue + options.value.noinvoce;
										options.totalValue = Math.round(options.totalValue * 100) / 100;
									}
								}
							}
						},

					},
					onCellClick: function (e) {
						if (e.columnIndex == 1) {
							//点击单号修改功能
							
							var lasttype =  e.data.lasttype;
							switch(lasttype){
								case 5:
																		parent.tab.tabAdd({

										icon: '',
										id: 'SKHJDH' + e.data.ordernum,
										title: e.data.ordernum + '分销核价',
										url: 'views/financiaManagement/receipt/addDistribution2.html'
									});
								case 1:										parent.tab.tabAdd({

										icon: '',
										id: 'SKHJDH' + e.data.ordernum,
										title: e.data.ordernum + '分销核价',
										url: 'views/financiaManagement/receipt/addDistribution2.html'
									});
								break;
								case 0:  //备货
										parent.tab.tabAdd({
											icon: '',
											id: 'ZXHJWC' + e.data.ordernum,
											title: e.data.ordernum + '直销核价',
											url: 'views/financiaManagement/directSelling/directSellingYiBan.html'
										});
						
								break;
								case 6: //备库结算
								       parent.tab.tabAdd({
				                           icon: '',
				                           id: 'ZXBKJS' + e.value,
				                           title: e.value + '直销备库详情',
				                           url: 'views/financiaManagement/settlement/addSettlement.html'
				                       });
                       
								break;
								case 7: //产品
								          parent.tab.tabAdd({
									        icon: '',
									        id: 'ZXCPJS' + e.value,
									        title:  e.value + '直销产品详情',
									        url: 'views/salesManagement/zhiXiaoProductSettment/zhiXiaoProductOprate.html'
									    });
			    
								break;
								case 8: //备库实耗
									parent.tab.tabAdd({
										icon: '',
										id: 'ZXHJWC' + e.data.ordernum,
										title: e.data.ordernum + '直销核价',
										url: 'views/financiaManagement/directSelling/directSellingYiBan.html'
									});
						
								break;
							}


			

						}
					}
				}).dxDataGrid('instance');
			});
		}

		//////////////////////分页
		function pagination(currentPage, limit, totalInfo) {
			$('.M-box2').empty();

			if (totalInfo == 0) {
				return;
			}
			$('.M-box2').pagination({
				current: currentPage,
				totalData: totalInfo,
				showData: limit,
				pageCount: Math.floor(totalInfo / limit),
				mode: 'fixed',
				isHide: true,
				jump: true,
				callback: function (api) {
					currentPage = api.getCurrent();
					waitData(currentPage, limit, totalInfo);
				}
			});
		}
		$('#lay-ignore').change(function () {
			limit = $(this).children('option:selected').val();
			waitData(currentPage, limit, totalInfo);
		});


		// 根据可视区的高度判断
		var viewHeight = $(window).height();
		if (viewHeight == 855) {
			$('#gridContainer').css('height', 650 + 'px'); //855*0.76
		} else {
			$('#gridContainer').css('height', viewHeight * 0.685 + 'px');
		}














		$(".find").click(function () {
			waitData(currentPage, limit, totalInfo);
		})

		$("body").keydown(function (event) {
			if (event.keyCode == "13") { //keyCode=13是回车键
				$('.find').click();

			}
		});


		//合并付款功能
		$('.addDianJiEvent').on('click', function () {
	



			var ordernumList = '';
			var arrForOderNum = [];
			var danhao = ' ';
			var danhao = $('.dx-selection');
			var newarr = [];
			danhao.get().forEach(function (currentValue, index, arr) {
				danhao = "\'" + currentValue.childNodes[1].innerText + "\'";
				newarr = arrForOderNum.push(danhao);
				ordernumList = arrForOderNum.join(",");
			});

			if (ordernumList.length == 0) {
				parent.layer.open({
					title: "提示",
					zIndex: parent.layer.zIndex, //重点1,
					content: '请选择要收款的单据!'
				});
				return;
			};




		});

	});
</script>


</html>