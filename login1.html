<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>青囊云平台登录</title>
	</head>
	<link rel="stylesheet" type="text/css" href="css/reset.css" />
	<link rel="stylesheet" type="text/css" href="plugins/layui/css/layui.css" />
	<style type="text/css">
		html,
		body {
			width: 100%;
			/*min-width: 1024px;*/
			height: 100%;
			/*min-height: 850px;*/
			box-sizing: border-box;
			overflow-y: visible
		}
		
		.container {
			width: 100%;
			height: 100%;
			background-image: url(image/background.png);
			background-size: 100% 100%;
			background-repeat-y: initial;
			background-size: 100% 100%;
			text-align: center;
			/*display: table;*/
		}
		
		.login_body {
			margin: auto;
			width: 406px;
			height: 478px;
			position: absolute;
			top: 0;
			left: 0;
			bottom: 0;
			right: 0;
			background-color: white;
			opacity: 0.9;
			border-radius: 10px;
		}
		
		.login_title {
			height: 52px;
			text-align: center;
			margin-top: 58px;
			line-height: 52px;
			margin-left: -180px;
		}
		
		.login_title img {
			display: inline-block;
		}
		
		.login_title .name {
			/*			position: absolute;
*/
			margin-left: 20px;
			width: auto;
			height: 52px;
			line-height: 52px;
		}
		
		.login_title .name1 {
			position: absolute;
			top: 50px;
			font-family: "YouYuan";
			font-size: 30px;
			color: #357BEA;
		}
		
		.login_title .name2 {
			/*margin-top: 8px;*/
			position: absolute;
			top: 80px;
			font-family: "PingFang";
			font-size: 14px;
			color: #7B7B7B;
		}
		
		.account {
			margin-left: 52px;
			margin-top: 36px;
			width: 302px;
		}
		
		.yanzhengma {
			/*margin-left: 50px;*/
			margin-top: 14px;
			width: 302px;
			position: relative;
		}
		
		.login_account,
		.login_pwd,
		.login_yanzhengma {
			width: 260px;
			border: 1px solid #7c7c7c;
			border-radius: 4px;
			position: relative;
			box-sizing: border-box;
			height: 38px;
			padding-left: 42px;
			font-family: "PingFang";
			font-size: 14px;
			color: #7c7c7c;
		}
		
		.login_yanzhengma {
			margin-left: 0px;
			padding-left: 14px;
			width: 160px;
		}
		
		.account img,
		.pwd img {
			position: absolute;
			margin: 8px 20px 8px 14px;
			z-index: 10;
		}
		
		.pwd {
			margin-top: 14px;
		}
		
		.login {
			width: 302px;
			height: 38px;
			margin-top: 20px;
			margin-left: 52px;
		}
		
		.login_btn,
		.login_zt {
			font-family: "PingFang";
			font-size: 18px;
			color: #fefefe;
			background-color: #357BEA;
			border: none;
			width: 130px;
			height: 38px;
			border: 1px solid #357BEA;
			cursor: pointer;
			border-radius: 4px;
		}
		
		.login_copyright {
			margin-top: 20px;
			/*margin-bottom: 26px;*/
			font-family: "PingFang";
			font-size: 12px;
			color: #357BEA;
		}
		
		.info p {
			margin-top: 12px;
			color: #232323;
			font-family: "PingFang SC";
			font-size: 12px;
			text-align: left;
			margin-left: 72px;
		}
		
		#create {
			display: inline-block;
			width: 100px;
			line-height: 35px !important;
			height: 35px !important;
			position: absolute;
			left: 240px;
			top: 0;
		}
		
		.change a {
			width: 80px;
			position: absolute;
			text-decoration: none;
			color: #357BEA;
			font-size: 12px;
			cursor: pointer;
			top: 30px;
		}
		
		.chooseZT {
			border: 1px solid #2D89DD;
			width: 400px;
			height: 300px;
			font-family: "PingFang SC";
			font-size: 12px;
			/*box-shadow: 0px 20px #90CAFF;*/
			/*position: relative;*/
			position: absolute;
			top: calc(50% - 150px);
			left: calc(50% - 200px);
			z-index: 100;
			background: #FFFFFF;
		}
		
		.chooseZT_title {
			margin-top: 14px;
			margin-left: 14px;
			color: #777777;
		}
		
		.chooseZT_title img {
			width: 20px;
		}
		
		.chooseZT_title span {
			margin-left: 10px;
		}
		
		.chooseZT_body {
			margin: 0 44px;
			margin-top: 30px;
		}
		
		.chooseZT_body .chooseZT_body_title .find {
			float: right;
		}
		
		a {
			text-decoration: none;
		}
		
		.chooseZT_body table {
			width: 452px;
			/*border: none;*/
			border: 1px solid #CCCCCC;
		}
		
		.chooseZT_body table tr {
			line-height: 22px;
			border-bottom: 1px solid #CCCCCC;
		}
		
		.chooseZT_footer {
			margin: 0 44px;
			margin-top: 45px;
		}
		
		.chooseZT_footer ul li {
			/*display: inline-block;*/
			width: 300px;
			margin-top: 20px;
		}
		
		.chooseZT_footer ul li label {
			display: inline-block;
			width: 60px;
		}
		
		.chooseZT_footer ul li input,
		.chooseZT_footer ul li select {
			display: inline-block;
			margin-left: 12px;
			width: 200px;
			border: none;
			line-height: 28px;
			height: 28px;
			border: 1px solid #CCCCCC;
			border-radius: 2px;
			box-sizing: border-box;
		}
		
		.chooseZT_footer_btn {
			margin-top: 20px;
			float: right;
		}
		
		.chooseZT_footer_btn button {
			cursor: pointer;
			border: none;
			background-color: #2D89DD;
			color: white;
			line-height: 28px;
			width: 70px;
			margin-left: 6px;
			border-radius: 2px;
		}
		
		.chooseZT .close {
			float: right;
			margin-right: 30px;
			font-size: 16px;
			cursor: pointer;
		}
	</style>

	<body>
		<div class="container">
			<div class="login_body">
				<div class="login_title">
					<img src="image/logo.png" alt="logo" width="52" height="52" />
					<span class="name">
						<span class="name1">青囊云平台</span>
					<span class="name2">权威的医疗器械管理系统</span>
					</span>
				</div>
				<div class="account">
					<img src="image/username.png" alt="" />
					<input type="text" class="login_account" value="" placeholder="请输入用户名" />
				</div>
				<div class="pwd">
					<img src="image/password.png" />
					<input type="password" class="login_pwd" placeholder="请输入密码" />
				</div>
				<div class="yanzhengma">
					<input type="text" class="login_yanzhengma" placeholder="请输入验证码" />
					<canvas id="create"></canvas>
					<span class="change"><a>看不清换一张</a></span>
				</div>
				<div class="login">
					<input type="button" class="login_zt" value="选择账套" />
					<input type="button" class="login_btn" value="登录" />
				</div>
				<div class="info">
					<p>选择账套：<span class="info_num"></span></p>
					<p>应用服务器地址：<span class="info_ip"></span></p>
				</div>
				<div class="login_copyright">
					<p>©南京吉帝思信息科技有限公司·版权所有</p>
				</div>
			</div>

		</div>
		<div class="chooseZT" style="display: none;">
			<div class="chooseZT_title">
				<img src="image/logo.png" alt="" /><span>选择账套</span>
				<span class="close">X</span>
			</div>
			<!--<div class="chooseZT_body">
				<div class="chooseZT_body_title">
					<span>服务器列表</span>
					<span class="find"><a href="">查找服务器</a></span>
				</div>
				<table border="1">
					<tr>
						<th>序号</th>
						<th>服务器名称</th>
						<th>服务器地址</th>
						<th>端口</th>
					</tr>
					<tr>
						<td>Data</td>
						<td>Data</td>
						<td>Data</td>
						<td>Data</td>
					</tr>
					<tr>
						<td>Data</td>
						<td>Data</td>
						<td>Data</td>
						<td>Data</td>
					</tr>
					<tr>
						<td>Data</td>
						<td>Data</td>
						<td>Data</td>
						<td>Data</td>
					</tr>
					<tr>
						<td>Data</td>
						<td>Data</td>
						<td>Data</td>
						<td>Data</td>
					</tr>

				</table>
			</div>-->
			<div class="chooseZT_footer">
				<ul>
					<!--<li>
						<label for="">服务器名称</label>
						<input type="text" name="" id="" value="" />
					</li>-->
					<li>
						<label for="">服务器地址</label>
						<input type="text" class="zhangtaoAddress" />
					</li>
					<li>
						<label for="">服务器端口</label>
						<input type="text" class="zhangtaoPort" />
					</li>

					<li>
						<label for="">选择账套</label>
						<select name="" class="zhangtaoResult">
						</select>
					</li>
				</ul>
				<div class="chooseZT_footer_btn">
					<!--<button>测试链接</button>-->
					<button class="confirm">确认</button>
				</div>
			</div>
		</div>
	</body>
	<script src="plugins/layui/layui.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
		layui.use(['element', "jquery", 'layer'], function() {
			var element = layui.element;
			var $ = layui.$;
			var layer = layui.layer;

			function showCheck(a) {
				//创建context对象内建的html5对象（拥有多种绘制路径、矩形、圆形、字符以及添加图像的方法。）
				//fillRect(x,y,width,height) 方法定义了矩形当前的填充方式。
				var cxt = document.getElementById('create').getContext('2d')
				//				console.log(cxt)
				//清空一个区域（给定矩形内的指定像素。）
				cxt.clearRect(0, 0, 500, 500)
				cxt.font = '80px Arial'
				cxt.fillStyle = "rgb(100,102,193)"
				//fillText(text,x,y) - 在 canvas 上绘制实心的文本
				cxt.fillText(a, 0, 100)

			}
			//在全局定义一个验证码
			var code;

			function createCode() {
				code = ''
				//验证码的长度 
				var codeLength = 4
				var selects = new Array(0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'j', 'k', 'l', 'm', 'n', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z', 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'J', 'K', 'L', 'M', 'N', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z')
				//随机选择一个验证码
				for(var i = 0; i < codeLength; i++) {
					var index = Math.floor(Math.random() * 61)
					code += selects[index]
				}
				//按照验证码的长度进行筛选
				if(code.length != codeLength) {
					createCode()
				}
				//展示验证码
				showCheck(code)
			}
			$(function() {
				createCode();
			})
			$('.change').click(function() {
				createCode()
			})
			$(".login_zt").click(function() {
//				console.log(localStorage.ztPath);
				if(localStorage.ztPath) {
					$.ajax({
						type: "get",
						url: localStorage.ztPath + "ByuWCFService/WebGetBooksList?jsoncallback=?",
						dataType: "jsonp",
						async: true,
						success: function(res) {
							$(".zhangtaoResult").empty();
							var data = JSON.parse(res);
							for(var i = 0; i < data.length; i++) {
								var opt = "<option>" + data[i].books + "</option>"
								$(".zhangtaoResult").append(opt);
							}
						}
					});
					$(".zhangtaoAddress").val(localStorage.zhangtaoAddress);
					$(".zhangtaoPort").val(localStorage.zhangtaoPort);
					$(".zhangtaoResult").val(localStorage.zhangtaoResult);
				}

				$(".chooseZT").css("display", "block");
			});
			$(".chooseZT .close").click(function() {
				$(".chooseZT").css("display", "none");
			})
			//默认值
			$(".info_num").text(localStorage.zhangtaoResult);
			$(".info_ip").text(localStorage.zhangtaoAddress);
			$(".zhangtaoAddress").val(localStorage.zhangtaoAddress);
			$(".zhangtaoPort").val(localStorage.zhangtaoPort);
			$(".zhangtaoResult").val(localStorage.zhangtaoResult);
			//点击确定
			$(".confirm").click(function() {
				var zhangtaoAddress = $(".zhangtaoAddress").val();
				var zhangtaoPort = $(".zhangtaoPort").val();
				var zhangtaoResult = $(".zhangtaoResult option:selected").val();
				var zt = "http://" + zhangtaoAddress + ":" + zhangtaoPort + "/";
				if(zhangtaoResult) {
					localStorage.zhangtaoAddress = zhangtaoAddress;
					localStorage.zhangtaoPort = zhangtaoPort;
					localStorage.zhangtaoResult = zhangtaoResult;
					localStorage.ztPath = zt;
					$(".chooseZT").css("display", "none");
					$(".info_num").text(localStorage.zhangtaoResult);
					$(".info_ip").text(localStorage.zhangtaoAddress);
				} else {
					layer.open({
						title: "提示",
						content: '请检查服务器地址和端口'
					});
				}
			})
			//			var zhangtaoResult = $(".zhangtaoResult").val();
			//			if(!zhangtaoResult) {
			//				$('.zhangtaoResult').click(function() {
			//					layer.open({
			//						title: "提示",
			//						content: '请检查服务器地址和端口'
			//					});
			//				})
			//
			//			}
			//滚动条的宽度
			//alert(window.innerWidth - document.body.clientWidth)
			function yanzheng() {

				if(inputCode.length <= 0) {
					$('.login_yanzhengma').attr('placeholder', '验证码')
					alert('请输入验证码')
					createCode()
					return false
				} else if(inputCode != codeUp) {
					$('.login_yanzhengma').val('')
					//修改属性值。
					$('.login_yanzhengma').val('').attr('placeholder', '请重新输入')
					alert('验证码填写错误')
					createCode()
					return false
				} else {

				}
			}
			//			var data = "[{\"books\":\"dd\"},{\"books\":\"柯润玺\"},{\"books\":\"第一帐套\"},{\"books\":\"78\"},{\"books\":\"新的测试帐套\"},{\"books\":\"青囊私服\"}]"

			$(".zhangtaoPort").blur(function() {
				zhangtao();
			});

			function zhangtao() {
				var zhangtaoAddress = $(".zhangtaoAddress").val();
				var zhangtaoPort = $(".zhangtaoPort").val();
				if(zhangtaoAddress && zhangtaoPort) {
					var zt = "http://" + zhangtaoAddress + ":" + zhangtaoPort + "/";
					$.ajax({
						type: "post",
						url: zt + "ByuWCFService/WebGetBooksList?jsoncallback=?",
						dataType: "jsonp",
						async: true,
						success: function(res) {
							$(".zhangtaoResult").empty();
							localStorage.zhangtaoAddress = zhangtaoAddress;
							localStorage.zhangtaoPort = zhangtaoPort;
							localStorage.ztPath = zt;
							var data = JSON.parse(res);
							for(var i = 0; i < data.length; i++) {
								var opt = "<option>" + data[i].books + "</option>"
								$(".zhangtaoResult").append(opt);
							}
						}
					});
				} else {
					layer.open({
						title: "提示",
						content: '请检查服务器地址和端口'
					});
				}
			}
			//登录
			function login_ajax() {
				var userName = $(".login_account").val();
				var pwd = $(".login_pwd").val();
				var database = $(".zhangtaoResult").val();
				var inputCode = $('.login_yanzhengma').val().toUpperCase();
				//把随机生成的验证码转化为大写
				var codeUp = code.toUpperCase()
				if(!userName) {
					layer.open({
						title: "提示",
						content: '请输入账号'
					});

				} else if(!pwd) {
					layer.open({
						title: "提示",
						content: '请输入密码'
					});
				} else if(inputCode.length <= 0) {
					$('.login_yanzhengma').attr('placeholder', '验证码');
					layer.open({
						title: "提示",
						content: '请输入验证码'
					});
					createCode()
					return false
				} else if(inputCode != codeUp) {
					$('.login_yanzhengma').val('')
					//修改属性值。
					$('.login_yanzhengma').val('').attr('placeholder', '请重新输入');
					layer.open({
						title: "提示",
						content: '验证码填写错误'
					});
					createCode();
					return false;
				} else {
					$.ajax({
						type: "get",
						url: "http://192.168.0.178/ByuWCFService/WebCheckUserLogin?jsoncallback=?",
						async: true,
						dataType: "jsonp",
						data: {
							"userId": userName,
							"userPw": pwd,
							'database': database
						},
						success: function(data) {
							console.log(data);
							localStorage.userId = userName;
							localStorage.userPw = pwd;
							localStorage.database = database;
							if(data.infoType == 1) {
								layer.open({
									title: "提示",
									content: '用户名不存在'
								});
							} else if(data.infoType == 2) {
								layer.open({
									title: "提示",
									content: '密码不正确'
								});
							} else if(data.infoType == 3) {
								layer.open({
									title: "提示",
									content: '无权登录'
								});
							} else if(data.infoType == 4) {
								layer.open({
									title: "提示",
									content: '登录异常'
								});
							} else if(data.infoType == 0) {
								location.href = "index.html"
							}
						}
					});
				}
			}
			$(".login_btn").click(function() {
				login_ajax();
			});

			$("body").keydown(function(event) {
				if(event.keyCode == "13") { //keyCode=13是回车键
					login_ajax();
					//					location.href = "index.html"
				}
			});

		});
		//显示验证码图片
	</script>

</html>